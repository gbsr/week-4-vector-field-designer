import"./modulepreload-polyfill-B5Qt9EMX.js";function P(){const n=window.location.hash,e=n.startsWith("#")?n.slice(1):n;return new URLSearchParams(e)}const v=P(),D=parseFloat(v.get("zoom")??"")||1,B=parseFloat(v.get("camx")??"")||0,_=parseFloat(v.get("camy")??"")||0,N=new Set(["export","import","from","const","let","var","function","return","if","else","for","of","in","while","type","interface","extends","implements","new","class","switch","case","break","default","as","number","string","boolean","void","any","unknown"]);function k(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function R(n){const e=[];let o="",s="plain",t=0;const c=n.length;function u(){o&&(e.push({kind:s,text:o}),o="")}for(;t<c;){const l=n[t],g=t+1<c?n[t+1]:"";if(s==="plain"&&l==="/"&&g==="/"){for(u(),s="comment",o+=l,t++,o+=n[t],t++;t<c&&n[t]!==`
`;)o+=n[t++];u(),s="plain";continue}if(s==="plain"&&l==="/"&&g==="*"){for(u(),s="comment",o+=l,t++,o+=n[t],t++;t<c;){const f=n[t],d=t+1<c?n[t+1]:"";if(o+=f,t++,f==="*"&&d==="/"){o+=d,t++;break}}u(),s="plain";continue}if(s==="plain"&&(l==='"'||l==="'"||l==="`")){u();const f=l;for(s="string",o+=l,t++;t<c;){const d=n[t];if(o+=d,t++,d==="\\"&&t<c){o+=n[t],t++;continue}if(d===f)break}u(),s="plain";continue}o+=l,t++}return u(),e}function O(n){return n.replace(/(\b[A-Za-z_][A-Za-z0-9_]*\b|\b\d+(?:\.\d+)?\b)/g,e=>/^\d/.test(e)?`<span class="tok-number">${e}</span>`:N.has(e)?`<span class="tok-kw">${e}</span>`:/^[A-Z]/.test(e)?`<span class="tok-type">${e}</span>`:e)}function $(n){const e=R(n);let o="";for(const s of e)s.kind==="comment"?o+=`<span class="tok-comment">${k(s.text)}</span>`:s.kind==="string"?o+=`<span class="tok-string">${k(s.text)}</span>`:o+=O(k(s.text));return o}const i=document.getElementById("codeInput"),h=document.querySelector(".code-shell .code-highlight"),E=document.getElementById("runButton"),I=document.getElementById("resetParticlesButton"),x=document.getElementById("status"),r=document.getElementById("fieldCanvas");if(!r)throw new Error('Canvas element with id "fieldCanvas" not found');const a=r.getContext("2d");if(!a)throw new Error("Could not get 2D context");i&&i.addEventListener("keydown",n=>{if(n.key==="Tab"){n.preventDefault();const e=i.selectionStart,o=i.selectionEnd,s=i.value,t="  ";i.value=s.slice(0,e)+t+s.slice(o),i.selectionStart=i.selectionEnd=e+t.length,L()}});function T(){if(!r)return;const n=r.getBoundingClientRect();r.width=n.width,r.height=n.height}const S=document.getElementById("backToDesignerButton");S&&S.addEventListener("click",()=>{history.back()});const M=document.getElementById("copyButton");M?.addEventListener("click",()=>{const n=i?.value??"";if(!n.trim()){p("Nothing to copy.",!0);return}navigator.clipboard.writeText(n).then(()=>{p("Code copied to clipboard.",!1)}).catch(e=>{console.error("Failed to copy text: ",e),p("Failed to copy code to clipboard.",!0)})});T();window.addEventListener("resize",T);const H=600,z=140,w=[];let m=null,C=performance.now();function p(n,e=!1){x&&(x.textContent=n,x.classList.remove("ok","error"),x.classList.add(e?"error":"ok"))}function q(){const n=v.get("code");if(!n)return null;try{return decodeURIComponent(n)}catch{return null}}function L(){if(!i||!h)return;const n=i.value??"";h.innerHTML=$(n),h.scrollTop=i.scrollTop,h.scrollLeft=i.scrollLeft}const b=q();i&&(b?i.value=b:i.value=`// Paste your generated field module here.
// It should define:
//   const FIELD_NODES = [...]
//   export function evaluateField(pos: { x: number; y: number }, nodes = FIELD_NODES) { ... }`,L(),i.addEventListener("input",()=>{L()}),i.addEventListener("scroll",()=>{h&&(h.scrollTop=i.scrollTop,h.scrollLeft=i.scrollLeft)}));function U(n){let e=n;e=e.replace(/^export\s+interface[\s\S]*?\}\s*$/gm,""),e=e.replace(/^interface[\s\S]*?\}\s*$/gm,""),e=e.replace(/^export\s+type[^\n]*\n/gm,""),e=e.replace(/^type[^\n]*\n/gm,""),e=e.replace(/export\s+const\s+FIELD_NODES\s*:[^=]+=/,"const FIELD_NODES ="),e=e.replace(/export\s+function\s+evaluateField\s*\(\s*pos\s*:[^,]+,\s*nodes\s*:[^)]+\)\s*:[^{]+{/,"function evaluateField(pos, nodes) {"),e=e.replace(/\bexport\s+/g,""),e=e.replace(/\?:/g,":"),e=e.replace(/\b(dist|radius|mode|deg)\s*:\s*(number|Falloff)\b/g,"$1"),e=e.replace(/\)\s*:\s*(number|Falloff|Vec2)\b/g,")"),e=e.replace(/return\s*\{\s*x\s*,\s*y\s*\}/g,"return { x: vx, y: vy }"),e=e.replace(/return\s*\{\s*x\s*:\s*vx\s*,\s*y\s*\}/g,"return { x: vx, y: vy }"),console.log(`=== CLEANED FIELD MODULE ===
`+e);const o=`
${e}

let nodesRef;

if (typeof FIELD_NODES !== "undefined") {
  nodesRef = FIELD_NODES;
} else if (typeof nodes !== "undefined") {
  nodesRef = nodes;
} else {
  throw new Error("No 'FIELD_NODES' or 'nodes' array found in pasted code.");
}

if (typeof evaluateField !== "function") {
  throw new Error("No global 'evaluateField' function found in pasted code.");
}

return { nodes: nodesRef, evaluateField };
  `;return new Function(o)()}function F(){if(r){w.length=0;for(let n=0;n<H;n++)w.push({x:Math.random()*r.width,y:Math.random()*r.height,trail:[],maxTrail:18+Math.random()*10})}}function W(n){if(!r||!m)return;const{nodes:e,evaluateField:o}=m,s=z;for(const t of w){const c=(t.x-r.width/2)/D+B,u=(t.y-r.height/2)/D+_,l=o({x:c,y:u},e);let g=l.x,f=l.y;const d=Math.hypot(g,f)||1;g/=d,f/=d,t.x+=g*s*n,t.y+=f*s*n;let y=!1;t.x<0?(t.x+=r.width,y=!0):t.x>r.width&&(t.x-=r.width,y=!0),t.y<0?(t.y+=r.height,y=!0):t.y>r.height&&(t.y-=r.height,y=!0),y?(t.trail.length=0,t.trail.push({x:t.x,y:t.y})):(t.trail.push({x:t.x,y:t.y}),t.trail.length>t.maxTrail&&t.trail.shift())}}function Y(){if(!(!r||!a)){a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,r.width,r.height),a.lineCap="round";for(const n of w){const e=n.trail;if(e.length<2)continue;const o=(n.x/r.width*180+180)%360;a.strokeStyle=`hsla(${o}, 70%, 60%, 0.85)`,a.lineWidth=1.4,a.beginPath();const s=e[0];a.moveTo(s.x,s.y);for(let t=1;t<e.length;t++){const c=e[t];a.lineTo(c.x,c.y)}a.stroke()}}}function A(n){const e=(n-C)/1e3;C=n,W(e),Y(),requestAnimationFrame(A)}requestAnimationFrame(A);E&&E.addEventListener("click",()=>{if(!i)return;const n=i.value;if(!n.trim()){p("Paste some generated field code first.",!0);return}try{m=U(n),F();const e=Array.isArray(m.nodes)?m.nodes.length:"unknown";p(`OK: loaded field module with ${e} node(s). Particles following field.`,!1)}catch(e){console.error(e),p(String(e),!0),m=null}});I&&I.addEventListener("click",()=>{F(),p("Particles reset.",!1)});b&&E?E.click():(p("Waiting for field codeâ€¦",!1),F());
